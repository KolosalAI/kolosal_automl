<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kolosal AutoML</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        .tab-active { border-bottom: 2px solid #3B82F6; color: #3B82F6; }
        .dropzone { border: 2px dashed #CBD5E1; }
        .dropzone.drag-over { border-color: #3B82F6; background: #EFF6FF; }
        .loading { opacity: 0.5; pointer-events: none; }
        .htmx-request .loading-indicator { display: block; }
        .htmx-request.htmx-indicator { display: inline; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen" x-data="kolosalApp()">
    <!-- Header -->
    <header class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-3">
                <svg class="w-10 h-10 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <h1 class="text-2xl font-bold text-gray-900">Kolosal AutoML</h1>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-500">Rust-Powered</span>
                <div class="w-2 h-2 rounded-full" :class="systemStatus === 'healthy' ? 'bg-green-500' : 'bg-red-500'"></div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex space-x-8">
                <button @click="activeTab = 'data'" :class="activeTab === 'data' ? 'tab-active' : ''" class="py-4 px-1 font-medium text-gray-700 hover:text-blue-600">
                    üìÅ Data Upload
                </button>
                <button @click="activeTab = 'config'" :class="activeTab === 'config' ? 'tab-active' : ''" class="py-4 px-1 font-medium text-gray-700 hover:text-blue-600">
                    ‚öôÔ∏è Configuration
                </button>
                <button @click="activeTab = 'training'" :class="activeTab === 'training' ? 'tab-active' : ''" class="py-4 px-1 font-medium text-gray-700 hover:text-blue-600">
                    üöÄ Training
                </button>
                <button @click="activeTab = 'compare'" :class="activeTab === 'compare' ? 'tab-active' : ''" class="py-4 px-1 font-medium text-gray-700 hover:text-blue-600">
                    üèÜ Compare
                </button>
                <button @click="activeTab = 'predict'" :class="activeTab === 'predict' ? 'tab-active' : ''" class="py-4 px-1 font-medium text-gray-700 hover:text-blue-600">
                    üîÆ Predict
                </button>
                <button @click="activeTab = 'monitor'" :class="activeTab === 'monitor' ? 'tab-active' : ''" class="py-4 px-1 font-medium text-gray-700 hover:text-blue-600">
                    üìä Monitor
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Data Upload Tab -->
        <div x-show="activeTab === 'data'" x-cloak>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- File Upload -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">Upload Data</h2>
                    <div 
                        class="dropzone rounded-lg p-8 text-center cursor-pointer transition-colors"
                        @dragover.prevent="$el.classList.add('drag-over')"
                        @dragleave="$el.classList.remove('drag-over')"
                        @drop.prevent="handleFileDrop($event)"
                        @click="$refs.fileInput.click()"
                    >
                        <input type="file" x-ref="fileInput" @change="uploadFile($event)" accept=".csv,.json,.parquet" class="hidden">
                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                        </svg>
                        <p class="text-gray-600">Drop your CSV, JSON, or Parquet file here</p>
                        <p class="text-sm text-gray-400 mt-2">or click to browse</p>
                    </div>
                    
                    <!-- Sample Datasets -->
                    <div class="mt-6">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">Or load a sample dataset:</h3>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="sample in sampleDatasets" :key="sample.id">
                                <button 
                                    @click="loadSampleData(sample.id)"
                                    class="px-3 py-1 bg-blue-50 text-blue-700 rounded-full text-sm hover:bg-blue-100 transition"
                                    x-text="sample.name"
                                ></button>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Data Preview -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">Data Preview</h2>
                    <template x-if="dataInfo">
                        <div>
                            <div class="mb-4 flex items-center justify-between">
                                <span class="text-sm text-gray-600">
                                    <span x-text="dataInfo.rows"></span> rows √ó <span x-text="dataInfo.columns"></span> columns
                                </span>
                                <button @click="refreshPreview()" class="text-blue-600 text-sm hover:underline">Refresh</button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200 text-sm">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <template x-for="col in dataPreview.columns" :key="col.name">
                                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase" x-text="col.name"></th>
                                            </template>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        <template x-for="(_, rowIdx) in Array(dataPreview.rows || 0)" :key="rowIdx">
                                            <tr>
                                                <template x-for="col in dataPreview.columns" :key="col.name + rowIdx">
                                                    <td class="px-3 py-2 text-gray-700" x-text="col.values[rowIdx] ?? ''"></td>
                                                </template>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </template>
                    <template x-if="!dataInfo">
                        <p class="text-gray-400 text-center py-8">No data loaded</p>
                    </template>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div x-show="activeTab === 'config'" x-cloak>
            <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                <h2 class="text-lg font-semibold mb-6">Training Configuration</h2>
                
                <div class="space-y-6">
                    <!-- Task Type -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Task Type</label>
                        <select x-model="config.taskType" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="classification">Classification</option>
                            <option value="regression">Regression</option>
                        </select>
                    </div>

                    <!-- Target Column -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Target Column</label>
                        <select x-model="config.targetColumn" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Select target...</option>
                            <template x-for="col in dataInfo?.column_names || []" :key="col">
                                <option :value="col" x-text="col"></option>
                            </template>
                        </select>
                    </div>

                    <!-- Preprocessing -->
                    <div class="border-t pt-4">
                        <h3 class="font-medium mb-3">Preprocessing</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Scaler</label>
                                <select x-model="config.scaler" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="none">None</option>
                                    <option value="standard">Standard</option>
                                    <option value="minmax">MinMax</option>
                                    <option value="robust">Robust</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Missing Values</label>
                                <select x-model="config.imputation" class="w-full px-3 py-2 border rounded-lg">
                                    <option value="drop">Drop</option>
                                    <option value="mean">Mean</option>
                                    <option value="median">Median</option>
                                    <option value="mode">Mode</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Cross-Validation -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Cross-Validation Folds: <span x-text="config.cvFolds"></span>
                        </label>
                        <input type="range" x-model="config.cvFolds" min="2" max="10" class="w-full">
                    </div>

                    <!-- Apply Button -->
                    <button 
                        @click="applyPreprocessing()"
                        class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                        :disabled="!dataInfo"
                    >
                        Apply Preprocessing
                    </button>
                </div>
            </div>
        </div>

        <!-- Training Tab -->
        <div x-show="activeTab === 'training'" x-cloak>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Model Selection -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">Select Models</h2>
                    <div class="space-y-3">
                        <template x-for="model in availableModels" :key="model.id">
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" :value="model.id" x-model="selectedModels" class="rounded text-blue-600">
                                <span x-text="model.name"></span>
                            </label>
                        </template>
                    </div>
                    
                    <button 
                        @click="startTraining()"
                        class="w-full mt-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                        :disabled="selectedModels.length === 0 || !config.targetColumn"
                    >
                        üöÄ Start Training
                    </button>
                </div>

                <!-- Training Progress -->
                <div class="lg:col-span-2 bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">Training Progress</h2>
                    
                    <template x-if="trainingJobs.length > 0">
                        <div class="space-y-4">
                            <template x-for="job in trainingJobs" :key="job.id">
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-medium" x-text="job.config?.model_type || 'Training'"></span>
                                        <span 
                                            class="px-2 py-1 text-xs rounded-full"
                                            :class="{
                                                'bg-yellow-100 text-yellow-800': job.status.Running,
                                                'bg-green-100 text-green-800': job.status.Completed,
                                                'bg-red-100 text-red-800': job.status.Failed
                                            }"
                                            x-text="Object.keys(job.status)[0]"
                                        ></span>
                                    </div>
                                    <template x-if="job.status.Running">
                                        <div>
                                            <div class="w-full bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full transition-all" :style="`width: ${job.status.Running.progress * 100}%`"></div>
                                            </div>
                                            <p class="text-sm text-gray-600 mt-1" x-text="job.status.Running.message"></p>
                                        </div>
                                    </template>
                                    <template x-if="job.status.Completed">
                                        <div class="text-sm text-gray-600">
                                            <template x-for="(value, key) in job.status.Completed.metrics" :key="key">
                                                <p><strong x-text="key + ':'"></strong> <span x-text="typeof value === 'number' ? value.toFixed(4) : JSON.stringify(value)"></span></p>
                                            </template>
                                        </div>
                                    </template>
                                    <template x-if="job.status.Failed">
                                        <p class="text-sm text-red-600" x-text="job.status.Failed.error"></p>
                                    </template>
                                </div>
                            </template>
                        </div>
                    </template>
                    <template x-if="trainingJobs.length === 0">
                        <p class="text-gray-400 text-center py-8">No training jobs yet</p>
                    </template>
                </div>
            </div>
        </div>

        <!-- Compare Tab -->
        <div x-show="activeTab === 'compare'" x-cloak>
            <div class="bg-white rounded-lg shadow p-6">
                <h2 class="text-lg font-semibold mb-4">Model Comparison</h2>
                
                <div class="mb-4 flex items-center space-x-4">
                    <button 
                        @click="compareAllModels()"
                        class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
                        :disabled="!config.targetColumn"
                    >
                        Compare All Models
                    </button>
                </div>

                <template x-if="comparisonResults.length > 0">
                    <div>
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Model</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Score</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Std Dev</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                <template x-for="result in comparisonResults" :key="result.model">
                                    <tr>
                                        <td class="px-4 py-3 font-medium" x-text="result.model"></td>
                                        <td class="px-4 py-3" x-text="(result.metrics.accuracy || result.metrics.r2 || 0).toFixed(4)"></td>
                                        <td class="px-4 py-3" x-text="(result.metrics.std || 0).toFixed(4)"></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        
                        <!-- Chart -->
                        <div class="mt-6">
                            <canvas id="comparisonChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Predict Tab -->
        <div x-show="activeTab === 'predict'" x-cloak>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">Input Data</h2>
                    <textarea 
                        x-model="predictionInput"
                        class="w-full h-48 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="Enter values as JSON or comma-separated..."
                    ></textarea>
                    <button 
                        @click="makePrediction()"
                        class="w-full mt-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
                    >
                        üîÆ Predict
                    </button>
                </div>
                
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold mb-4">Predictions</h2>
                    <template x-if="predictions">
                        <pre class="bg-gray-50 p-4 rounded-lg text-sm overflow-auto" x-text="JSON.stringify(predictions, null, 2)"></pre>
                    </template>
                    <template x-if="!predictions">
                        <p class="text-gray-400 text-center py-8">No predictions yet</p>
                    </template>
                </div>
            </div>
        </div>

        <!-- Monitor Tab -->
        <div x-show="activeTab === 'monitor'" x-cloak>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">CPU Usage</h3>
                    <p class="text-3xl font-bold text-blue-600" x-text="(systemInfo.cpu_usage || 0).toFixed(1) + '%'"></p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Memory Usage</h3>
                    <p class="text-3xl font-bold text-green-600" x-text="(systemInfo.memory_usage_percent || 0).toFixed(1) + '%'"></p>
                    <p class="text-sm text-gray-400" x-text="`${(systemInfo.used_memory_gb || 0).toFixed(1)} / ${(systemInfo.total_memory_gb || 0).toFixed(1)} GB`"></p>
                </div>
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Status</h3>
                    <p class="text-3xl font-bold text-green-600" x-text="systemStatus"></p>
                </div>
            </div>

            <div class="mt-6 bg-white rounded-lg shadow p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">System Status</h2>
                    <button @click="refreshSystemStatus()" class="text-blue-600 text-sm hover:underline">Refresh</button>
                </div>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-2xl font-bold" x-text="systemInfo.datasets_count || 0"></p>
                        <p class="text-sm text-gray-500">Datasets</p>
                    </div>
                    <div>
                        <p class="text-2xl font-bold" x-text="systemInfo.jobs_count || 0"></p>
                        <p class="text-sm text-gray-500">Jobs</p>
                    </div>
                    <div>
                        <p class="text-2xl font-bold" x-text="systemInfo.models_count || 0"></p>
                        <p class="text-sm text-gray-500">Models</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div class="fixed bottom-4 right-4 space-y-2" x-show="notifications.length > 0">
        <template x-for="(notif, idx) in notifications" :key="idx">
            <div 
                class="px-4 py-3 rounded-lg shadow-lg"
                :class="{
                    'bg-green-500 text-white': notif.type === 'success',
                    'bg-red-500 text-white': notif.type === 'error',
                    'bg-blue-500 text-white': notif.type === 'info'
                }"
                x-text="notif.message"
                x-transition
            ></div>
        </template>
    </div>

    <script>
        function kolosalApp() {
            return {
                activeTab: 'data',
                systemStatus: 'healthy',
                
                // Data state
                dataInfo: null,
                dataPreview: { rows: 0, columns: [] },
                
                // Sample datasets
                sampleDatasets: [
                    { id: 'iris', name: 'üå∏ Iris' },
                    { id: 'diabetes', name: 'üíâ Diabetes' },
                    { id: 'boston', name: 'üè† Boston' },
                    { id: 'wine', name: 'üç∑ Wine' },
                    { id: 'breast_cancer', name: 'üéóÔ∏è Breast Cancer' },
                ],
                
                // Configuration
                config: {
                    taskType: 'classification',
                    targetColumn: '',
                    scaler: 'standard',
                    imputation: 'mean',
                    cvFolds: 5,
                },
                
                // Models
                availableModels: [
                    { id: 'logistic_regression', name: 'Logistic Regression' },
                    { id: 'linear_regression', name: 'Linear Regression' },
                    { id: 'decision_tree', name: 'Decision Tree' },
                    { id: 'random_forest', name: 'Random Forest' },
                ],
                selectedModels: [],
                trainingJobs: [],
                
                // Comparison
                comparisonResults: [],
                
                // Prediction
                predictionInput: '',
                predictions: null,
                
                // System
                systemInfo: {},
                
                // Notifications
                notifications: [],
                
                // Methods
                async init() {
                    await this.refreshSystemStatus();
                    setInterval(() => this.pollJobs(), 2000);
                },
                
                notify(message, type = 'info') {
                    this.notifications.push({ message, type });
                    setTimeout(() => this.notifications.shift(), 3000);
                },
                
                async uploadFile(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const formData = new FormData();
                    formData.append('file', file);
                    
                    try {
                        const resp = await fetch('/api/data/upload', { method: 'POST', body: formData });
                        const data = await resp.json();
                        if (data.success) {
                            this.dataInfo = data;
                            await this.refreshPreview();
                            this.notify('Data uploaded successfully!', 'success');
                        } else {
                            this.notify(data.message || 'Upload failed', 'error');
                        }
                    } catch (e) {
                        this.notify('Upload failed: ' + e.message, 'error');
                    }
                },
                
                handleFileDrop(event) {
                    const file = event.dataTransfer.files[0];
                    if (file) {
                        const dt = new DataTransfer();
                        dt.items.add(file);
                        this.$refs.fileInput.files = dt.files;
                        this.uploadFile({ target: { files: [file] } });
                    }
                },
                
                async loadSampleData(name) {
                    try {
                        const resp = await fetch(`/api/data/sample/${name}`);
                        const data = await resp.json();
                        if (data.success) {
                            this.dataInfo = data;
                            await this.refreshPreview();
                            this.notify(`Loaded ${name} dataset!`, 'success');
                        }
                    } catch (e) {
                        this.notify('Failed to load sample: ' + e.message, 'error');
                    }
                },
                
                async refreshPreview() {
                    try {
                        const resp = await fetch('/api/data/preview?rows=10');
                        this.dataPreview = await resp.json();
                    } catch (e) {
                        console.error('Preview failed:', e);
                    }
                },
                
                async applyPreprocessing() {
                    try {
                        const resp = await fetch('/api/preprocess', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                scaler: this.config.scaler,
                                imputation: this.config.imputation,
                            }),
                        });
                        const data = await resp.json();
                        if (data.success) {
                            await this.refreshPreview();
                            this.notify('Preprocessing applied!', 'success');
                        }
                    } catch (e) {
                        this.notify('Preprocessing failed: ' + e.message, 'error');
                    }
                },
                
                async startTraining() {
                    for (const modelId of this.selectedModels) {
                        try {
                            const resp = await fetch('/api/train', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    target_column: this.config.targetColumn,
                                    task_type: this.config.taskType,
                                    model_type: modelId,
                                    cv_folds: this.config.cvFolds,
                                }),
                            });
                            const data = await resp.json();
                            if (data.success) {
                                this.trainingJobs.push({
                                    id: data.job_id,
                                    config: { model_type: modelId },
                                    status: { Running: { progress: 0, message: 'Starting...' } },
                                });
                                this.notify(`Training started for ${modelId}`, 'info');
                            }
                        } catch (e) {
                            this.notify('Training failed: ' + e.message, 'error');
                        }
                    }
                },
                
                async pollJobs() {
                    for (const job of this.trainingJobs) {
                        if (job.status.Completed || job.status.Failed) continue;
                        try {
                            const resp = await fetch(`/api/train/status/${job.id}`);
                            const data = await resp.json();
                            job.status = data.status;
                        } catch (e) {
                            console.error('Poll failed:', e);
                        }
                    }
                },
                
                async compareAllModels() {
                    try {
                        const models = this.config.taskType === 'classification' 
                            ? ['logistic_regression', 'decision_tree', 'random_forest']
                            : ['linear_regression', 'decision_tree', 'random_forest'];
                        
                        const resp = await fetch('/api/train/compare', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                target_column: this.config.targetColumn,
                                task_type: this.config.taskType,
                                models: models,
                                cv_folds: this.config.cvFolds,
                            }),
                        });
                        const data = await resp.json();
                        if (data.success) {
                            this.comparisonResults = data.comparison;
                            this.notify('Comparison complete!', 'success');
                            this.renderComparisonChart();
                        }
                    } catch (e) {
                        this.notify('Comparison failed: ' + e.message, 'error');
                    }
                },
                
                renderComparisonChart() {
                    const ctx = document.getElementById('comparisonChart');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: this.comparisonResults.map(r => r.model),
                            datasets: [{
                                label: this.config.taskType === 'classification' ? 'Accuracy' : 'R¬≤',
                                data: this.comparisonResults.map(r => r.metrics.accuracy || r.metrics.r2 || 0),
                                backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                borderColor: 'rgb(59, 130, 246)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: { y: { beginAtZero: true, max: 1 } }
                        }
                    });
                },
                
                async makePrediction() {
                    try {
                        const resp = await fetch('/api/predict', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ data: this.predictionInput }),
                        });
                        this.predictions = await resp.json();
                    } catch (e) {
                        this.notify('Prediction failed: ' + e.message, 'error');
                    }
                },
                
                async refreshSystemStatus() {
                    try {
                        const resp = await fetch('/api/system/status');
                        const data = await resp.json();
                        this.systemInfo = { ...data.system, ...data };
                        this.systemStatus = data.status;
                    } catch (e) {
                        this.systemStatus = 'error';
                    }
                },
            };
        }
    </script>
</body>
</html>
